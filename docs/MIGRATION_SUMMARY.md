# 📊 newstable → articles 遷移總結

## 快速概覽

```
目前狀態：使用 newstable 表格
目標狀態：使用 articles 表格
主要挑戰：部分欄位缺失（imageUrl, labels, category）
```

---

## 🔄 資料流程比較

### 現在（使用 newstable）
```
Supabase (newstable)
    ↓
    └─ 查詢所有欄位
         ↓
         └─ 直接映射到 NewsArticle
              ↓
              └─ ArticleCard 顯示
                   ├─ ✅ 標題
                   ├─ ✅ 圖片
                   ├─ ✅ 摘要
                   ├─ ✅ 來源
                   ├─ ✅ 標籤
                   └─ ✅ 時間
```

### 方案 A（最小可行）
```
Supabase (articles + sources JOIN)
    ↓
    └─ 查詢基本欄位 + JOIN sources
         ↓
         └─ 映射到 NewsArticle
              ├─ ai_summary → structuredSummary
              ├─ original_url → url
              ├─ sources.name → source
              └─ ❌ imageUrl = undefined
              └─ ❌ labels = []
                   ↓
                   └─ ArticleCard 顯示
                        ├─ ✅ 標題
                        ├─ ❌ 無圖片
                        ├─ ✅ 摘要
                        ├─ ✅ 來源
                        ├─ ❌ 無標籤
                        └─ ✅ 時間
```

### 方案 B（完整方案）
```
1. 資料庫遷移
   └─ ALTER TABLE articles
        ├─ ADD image_url
        ├─ ADD category
        └─ ADD labels (JSONB)

2. 資料遷移
   └─ newstable → articles
        ├─ 遷移所有欄位
        ├─ 建立 sources 對應
        └─ 轉換 labels 格式

3. 查詢與顯示
   └─ Supabase (articles + sources JOIN)
        ↓
        └─ 查詢所有欄位
             ↓
             └─ ArticleCard 顯示
                  ├─ ✅ 標題
                  ├─ ✅ 圖片
                  ├─ ✅ 摘要
                  ├─ ✅ 來源
                  ├─ ✅ 標籤
                  └─ ✅ 時間
```

---

## 📋 欄位對應表

| UI 顯示 | newstable | articles (方案A) | articles (方案B) |
|---------|-----------|------------------|------------------|
| 標題 | `title` | `title` ✅ | `title` ✅ |
| 圖片 | `imageUrl` | ❌ 無 | `image_url` ✅ |
| 摘要 | `structuredSummary` | `ai_summary` ✅ | `ai_summary` ✅ |
| 來源 | `source` | `sources.name` ✅ | `sources.name` ✅ |
| 標籤 | `labels[]` | ❌ 無 | `labels` ✅ |
| 分類 | `category` | ❌ 無 | `category` ✅ |
| 時間 | `publishedAt` | `published_at` ✅ | `published_at` ✅ |
| 連結 | `url` | `original_url` ✅ | `original_url` ✅ |

---

## 🎯 卡片顯示效果比較

### 現在（newstable）
```
┌─────────────────────────────────┐
│ The Verge        Oct 26, 2:00 PM│
├─────────────────────────────────┤
│ The next legal frontier is...   │
├─────────────────────────────────┤
│ [████████ 圖片 ████████]        │
├─────────────────────────────────┤
│ In 2023, the release of the...  │
│ AI-generated song "Heart on...  │
├─────────────────────────────────┤
│ [AI] [legal] [copyright] ...    │
├─────────────────────────────────┤
│ [Pass]  [Open]  [Like]          │
└─────────────────────────────────┘
```

### 方案 A（最小可行）
```
┌─────────────────────────────────┐
│ The Verge        Oct 26, 2:00 PM│
├─────────────────────────────────┤
│ The next legal frontier is...   │
├─────────────────────────────────┤
│ [無圖片]                         │
├─────────────────────────────────┤
│ In 2023, the release of the...  │
│ AI-generated song "Heart on...  │
├─────────────────────────────────┤
│ [無標籤]                         │
├─────────────────────────────────┤
│ [Pass]  [Open]  [Like]          │
└─────────────────────────────────┘
```

### 方案 B（完整方案）
```
┌─────────────────────────────────┐
│ The Verge        Oct 26, 2:00 PM│
├─────────────────────────────────┤
│ The next legal frontier is...   │
├─────────────────────────────────┤
│ [████████ 圖片 ████████]        │
├─────────────────────────────────┤
│ In 2023, the release of the...  │
│ AI-generated song "Heart on...  │
├─────────────────────────────────┤
│ [AI] [legal] [copyright] ...    │
├─────────────────────────────────┤
│ [Pass]  [Open]  [Like]          │
└─────────────────────────────────┘
```

---

## ⚡ 效能比較

| 指標 | newstable | articles (方案A) | articles (方案B) |
|------|-----------|------------------|------------------|
| 查詢複雜度 | 簡單 | 中等（需 JOIN） | 中等（需 JOIN） |
| 查詢速度 | 快 | 中等 | 中等 |
| 資料完整性 | 100% | ~70% | 100% |
| 未來擴展性 | 低 | 中 | 高 |
| 社交功能支援 | ❌ | ✅ | ✅ |

---

## 💰 成本分析

### 方案 A
- **開發時間**: 30 分鐘
- **測試時間**: 15 分鐘
- **風險**: 低
- **可逆性**: 高（容易回滾）

### 方案 B
- **開發時間**: 4-6 小時
  - 資料庫遷移: 1 小時
  - 資料遷移腳本: 2 小時
  - 程式碼更新: 1 小時
  - 測試與驗證: 1-2 小時
- **測試時間**: 1 小時
- **風險**: 中
- **可逆性**: 中（需要回滾資料庫）

---

## 🚦 決策建議

### 選擇方案 A 如果：
- ✅ 需要快速驗證可行性
- ✅ 圖片和標籤不是必需功能
- ✅ 想要降低風險
- ✅ 時間有限

### 選擇方案 B 如果：
- ✅ 需要完整的用戶體驗
- ✅ 圖片是重要的視覺元素
- ✅ 標籤功能對內容分類很重要
- ✅ 有充足的開發和測試時間

### 推薦策略：先 A 後 B
1. **第一週**: 實作方案 A
   - 快速上線
   - 收集用戶反饋
   - 驗證 articles 表格可行性

2. **第二週**: 根據反饋決定
   - 如果用戶強烈需要圖片 → 升級到方案 B
   - 如果基本功能足夠 → 保持方案 A
   - 可以逐步添加功能

---

## 📝 下一步行動

請確認以下問題，我會立即開始實作：

1. **選擇方案**
   - [ ] 方案 A（最小可行）
   - [ ] 方案 B（完整方案）
   - [ ] 先 A 後 B（分階段）

2. **確認 sources 表格**
   - 目前 sources 表格是空的
   - 需要先填充來源資料
   - 或者在遷移時自動創建

3. **測試環境**
   - [ ] 在開發環境測試
   - [ ] 需要備份現有資料
   - [ ] 準備回滾計畫

**準備好了嗎？告訴我您的選擇，我會立即開始！** 🚀
